<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>My Account</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Koulen' rel='stylesheet'>

    <!-- I just added this for edit's pencil symbol -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="/stylesheet/style.css" />
    <link rel="stylesheet" href="/stylesheet/myaccount.css" />
    <script src="/javascript/editAccount.js"></script>
    <script src="/javascript/dropDown.js"></script>
</head>

<body class="main-body">
    <div th:replace="fragments/header::header"></div>
    <div class="content-container">
        <h1>My Account</h1>

        <div class="accountDetails" id="userDisplay">
            <h2>Account Details</h2>

            <div class="detail">
                <p>Username: <span id="usernameDisplay"
                        th:text="${user.username != null ? user.username : 'Username'}">Username</span> <a href="#"
                        onclick="showEdit('editUsernameSection')"><i class="fas fa-pencil-alt"></i></a></p>
            </div>

            <div class="detail">
                <p>Password: <span id="passwordDisplay"
                        th:text="${user.password != null ? user.password : 'Password'}">Password</span> <a href="#"
                        onclick="showEdit('editPasswordSection')"><i class="fas fa-pencil-alt"></i></a></p>
            </div>

            <div class="detail">
                <p>Bio: <span id="bioDisplay" th:text="${user.bio} ? ${user.bio} : ' '">Bio</span> <a href="#"
                        onclick="showEdit('editBioSection')"><i class="fas fa-pencil-alt"></i></a></p>
            </div>
        </div>

        <input type="hidden" id="userId" name="userId" th:value="${user.getId()}">
        <input type="hidden" id="origUsername" name="origUsername" th:value="${user.username}">
        <input type="hidden" id="origPassword" name="origPassword" th:value="${user.password}">
        <input type="hidden" id="origBio" name="origBio" th:value="${user.bio} ? ${user.bio} : ' '">



        <div id="editUsernameSection" class="editForm" style="display: none;">
            <h2>Edit Username</h2>
            <form id="usernameForm" onsubmit="saveChanges('editUsernameSection'); return false;">
                <meta name="_csrf" th:content="${_csrf.token}" />
                <meta name="_csrf_parameter" th:content="${_csrf.parameterName}" />

                <label for="newUsername">New Username:</label><br>
                <input type="text" id="newUsername" name="newUsername" maxlength="255" required><br><br>

                <button type="button" class="changes-btn" onclick="cancelEdit('editUsernameSection')">Cancel</button>
                <button type="submit" class="changes-btn">Save Changes</button>
            </form>
        </div>

        <div id="editPasswordSection" class="editForm" style="display: none;">
            <h2>Edit Password</h2>
            <form id="passwordForm" onsubmit="saveChanges('editPasswordSection'); return false;">
                <meta name="_csrf" th:content="${_csrf.token}" />
                <meta name="_csrf_parameter" th:content="${_csrf.parameterName}" />

                <label for="newPassword">New Password:</label><br>
                <input type="password" id="newPassword" name="newPassword" maxlength="255" required><br><br>

                <button type="button" class="changes-btn" onclick="cancelEdit('editPasswordSection')">Cancel</button>
                <button type="submit" class="changes-btn">Save Changes</button>
            </form>
        </div>

        <div id="editBioSection" class="editForm" style="display: none;">
            <h2>Edit Bio</h2>
            <form id="bioForm" onsubmit="saveChanges('editBioSection'); return false;">
                <meta name="_csrf" th:content="${_csrf.token}" />
                <meta name="_csrf_parameter" th:content="${_csrf.parameterName}" />

                <label for="newBio">New Bio:</label><br>
                <textarea id="newBio" name="newBio" maxlength="500"
                    placeholder="Enter your bio (500 chars max)"></textarea><br><br>

                <button type="button" class="changes-btn" onclick="cancelEdit('editBioSection')">Cancel</button>
                <button type="submit" class="changes-btn">Save Changes</button>
            </form>
        </div>

        <div id="manageAccountDisplay">
            <h2>Manage Account</h2><br>
            <form id="deleteForm" th:action="@{/user/{user.getId()}}" method="post"
                onsubmit="return confirm('Are you sure you want to delete your account?');">
                <meta name="_csrf" th:content="${_csrf.token}" />
                <meta name="_csrf_header" th:content="${_csrf.headerName}" />
                <button type="button" class="delete-btn" onclick="deleteUser()">Delete Account</button><br><br>
            </form>
            <form th:action="@{/logout}" method="post">
                <a href="#" class="logout-btn changes-btn" onclick="this.closest('form').submit();return false;">Log out</a>
            </form>
        </div>

    </div>
</body>

</html>