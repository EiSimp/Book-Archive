<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>My Account</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Koulen' rel='stylesheet'>

    <link rel="stylesheet" href="/stylesheet/style.css" />
    <link rel="stylesheet" href="/stylesheet/myaccount.css" />
    <script src="/javascript/editAccount.js"></script>
    <script src="/javascript/dropDown.js"></script>
</head>

<body class="main-body">
    <div th:replace="fragments/header::header"></div>
    <div class="content-container">
        <h1>My Account</h1>

        <div class="accountDetails" id="userDisplay">
            <h2>Account Details</h2>
            <a href="#" onclick="editField()">Edit</a>

            <p>Username: <span id="usernameDisplay" th:text="${user.username != null ? user.username : 'Username'}">Username</span></p>
            <!-- Password display as part of test -->
            <p>Password: <span id="passwordDisplay" th:text="${user.password != null ? user.password : 'Password'}">Password</span></p>
            <p>Bio: <span id="bioDisplay" th:text="${user.bio} ? ${user.bio} : ' '"></span></p>
        </div>


        <!-- form to change user info
        form doesn't appear until user clicks edit -->
        <div id="editForm" style="display: none;">
            <h2>Edit Account Details</h2>
            <!-- return false just disables default behaviour -->
            <form th:action="@{/user/{user.getId()}}" onsubmit="saveChanges(); return false;">
                <meta name="_csrf" th:content="${_csrf.token}" />
                <meta name="_csrf_parameter" th:content="${_csrf.parameterName}" />
                <!-- Hidden input field for user ID for passing into backend -->
                <input type="hidden" id="userId" name="userId" th:value="${user.getId()}">


                <label for="editUsername">Username:</label><br>
                <input type="text" id="editUsername" name="editUsername" maxlength="255" required><br><br>

                <!-- remove later for security -->
                <label for="editPassword">Password:</label><br>
                <input type="password" id="editPassword" name="editPassword" maxlength="255" required><br><br>

                <label for="editBio">Bio:</label><br>
                <textarea id="editBio" name="editBio" placeholder="Enter your bio (500 chars max)" maxlength="500"></textarea><br><br>

                <button type="button" class="changes-btn" onclick="cancelEdit()">Cancel</button>
                <button type="submit" class="changes-btn">Save Changes</button>
            </form>
        </div>

        <div id="manageAccountDisplay">
            <h2>Manage Account</h2><br>
            <form id="deleteForm" th:action="@{/user/{user.getId()}}" method="post" onsubmit="return confirm('Are you sure you want to delete your account?');">
                <meta name="_csrf" th:content="${_csrf.token}" />
                <meta name="_csrf_header" th:content="${_csrf.headerName}" />
                <button type="button" class="delete-btn" onclick="deleteUser()">Delete Account</button><br><br>
            </form>
            <form th:action="@{/logout}" method="post">
                <a href="#" class="logout-btn changes-btn" onclick="this.closest('form').submit();return false;">Log out</a>
            </form>
        </div>

    </div>
</body>

</html>